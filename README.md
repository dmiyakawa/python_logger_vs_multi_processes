# これは何

1つのプログラムを複数のプロセスで動作させ、
同じファイルを対象にRotatingFileHandlerでローテーションを行った際に
何が起こるかを実験するためのプログラム。

# 説明

単一プログラム内のマルチスレッドでの対応については公式ドキュメントに
記載があるのでここでは議論しない。
https://docs.python.jp/3/howto/logging-cookbook.html

上記の説明からも容易に予想できることではあるが、単純に
「ソースコードレベルではローテーションも書込みも何らロックされない」
ので、同じファイルを対象にログを書きあって同じタイミングでローテーションを
複数のプロセスが行おうとすると、ローテーション時に一部のログが消失する。

なおローテーションがない場合、Streamへのflushがログレコード単位で
毎回発生するため、LogRecordがOSのバッファより十分小さければ
「行が混ざる」リスクはかなり低いと予想できる。

一方、ログローテーションについてはローテーションの可否を決める
shouldRollover()および実際にローテーション操作を行うdoRollover()が
毎emit()毎に呼ばれる際、そこで何らロックをしていない。

よって、ローテーションは独立したプロセス・スレッドで独立に判断され、
結果がおかしなことになることがあり得る。


# License

MIT

Trust me, you won't be sued :-)
And, don't sue me for this kind of tiny junk-ish program :-(
